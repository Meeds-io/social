package org.exoplatform.social.service.malwareDetection;

import org.mockito.Mockito;

import org.exoplatform.social.service.malwareDetection.connector.MalwareDetectionServiceConnector;
import org.exoplatform.social.service.test.AbstractResourceTest;

public class MalwareDetectionServiceTest extends AbstractResourceTest {
  
  private MalwareDetectionService malwareDetectionService;

  public void setUp() throws Exception {
    super.setUp();
    malwareDetectionService = getContainer().getComponentInstanceOfType(MalwareDetectionService.class);
  }

  public void testProcessInfectedItem() {
    String infectedItemPath = "/gatein/data/files/d/e/4/c/e/2/d/7/dedeerere673r777";
    MalwareDetectionServiceConnector malwareDetectionServiceConnector = Mockito.mock(MalwareDetectionServiceConnector.class);
    Mockito.when(malwareDetectionServiceConnector.getType()).thenReturn(MalwareDetectionService.FILES_CONNECTOR);
    malwareDetectionService.addConnector(malwareDetectionServiceConnector);
    Mockito.when(malwareDetectionServiceConnector.isEnable()).thenReturn(true);
    malwareDetectionService.processInfectedItem(infectedItemPath);
    Mockito.verify(malwareDetectionServiceConnector, Mockito.times(1)).sendInfectedItemNotification(infectedItemPath);
    Mockito.verify(malwareDetectionServiceConnector, Mockito.times(1)).cleanInfectedItem(infectedItemPath);
  }
}